# Add to database config:
# apoc.import.file.enabled=true

:auto USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM "file:///persons.csv" AS row
CREATE (:Entity:Person {statementID: row.statementID, birthDate: row.birthDate, nationality: row.nationality});

:auto USING PERIODIC COMMIT LOAD CSV WITH HEADERS FROM "file:///companies.csv" AS row
CREATE (:Entity:Company {statementID: row.statementID, name: row.name, foundingDate: row.foundingDate, dissolutionDate: row.dissolutionDate, countryCode: row.countryCode, companiesHouseID: row.companiesHouseID, openCorporatesID: row.openCorporatesID, openOwnershipRegisterID: row.openOwnershipRegisterID, CompanyCategory: row.CompanyCategory, CompanyStatus: row.CompanyStatus, Accounts_AccountCategory: row.Accounts_AccountCategory, SICCode_SicText_1: row.SICCode_SicText_1});


CREATE INDEX
FOR (n:Entity)
ON (n.statementID);


CALL apoc.periodic.iterate(
'
CALL apoc.load.csv("file:///relationships.csv") YIELD map AS row 
RETURN row
',
'
MATCH (a:Entity),(b:Company)
WHERE a.statementID = row.interestedPartyStatementID AND b.statementID = row.subjectStatementID
CREATE (a)-[r:Ownership {minimumShare: row.minimumShare}]->(b)
',
{batchSize:50000, parallel:true}
)

